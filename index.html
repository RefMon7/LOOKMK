<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mini Tycoon 3D</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        font-family: 'Segoe UI', sans-serif;
        background: #1c1c2b;
        color: #fff;
    }

    /* HUD */
    #hud {
        position: fixed;
        top: 15px;
        left: 15px;
        font-size: 22px;
        background: rgba(0,0,0,0.45);
        padding: 12px 18px;
        border-radius: 10px;
        backdrop-filter: blur(5px);
    }

    #shop-btn {
        position: fixed;
        right: 20px;
        top: 15px;
        background: #4a7efc;
        padding: 12px 20px;
        border-radius: 10px;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 0 12px rgba(74,126,252,0.6);
    }
    #shop-btn:hover {
        background: #6b94ff;
    }

    /* –ú–∞–≥–∞–∑–∏–Ω */
    #shop {
        position: fixed;
        right: 20px;
        top: 70px;
        background: rgba(0,0,0,0.6);
        padding: 15px;
        width: 280px;
        border-radius: 10px;
        display: none;
        backdrop-filter: blur(6px);
    }
    .shop-item {
        background: rgba(255,255,255,0.08);
        padding: 10px;
        margin: 10px 0;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
    }
    .shop-item:hover {
        background: rgba(255,255,255,0.2);
    }

    /* –°—Ü–µ–Ω–∞ */
    #scene {
        width: 100vw;
        height: 100vh;
        perspective: 900px;
        overflow: hidden;
    }

    #world {
        width: 1600px;
        height: 1600px;
        margin: auto;
        transform-style: preserve-3d;
        position: relative;
        top: 50%;
        transform: translateY(-50%) rotateX(55deg) rotateZ(45deg);
    }

    .tile {
        position: absolute;
        width: 200px;
        height: 200px;
        background: #2d2d3f;
        border: 2px solid #444;
        border-radius: 6px;
        transition: 0.2s;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .tile.built {
        background: #4caf50;
        box-shadow: 0 0 20px rgba(76,175,80,0.8);
    }

    /* –ò–≥—Ä–æ–∫ */
    #player {
        width: 40px;
        height: 40px;
        position: absolute;
        background: #ffeb3b;
        border-radius: 50%;
        transform-style: preserve-3d;
        box-shadow: 0 0 20px rgba(255,235,59,0.8);
    }
</style>
</head>
<body>

<div id="hud">üí∞ <span id="money">0</span></div>
<div id="shop-btn">üõí –ú–∞–≥–∞–∑–∏–Ω</div>

<div id="shop"></div>

<div id="scene">
    <div id="world"></div>
</div>

<script>
/* ----------------- –î–ê–ù–ù–´–ï ------------------ */

let money = 0;
let income = 0;

const SIZE = 5;
const TILE_SIZE = 200;

const buildings = [
    {name: "–ü–∞–ª–∞—Ç–∫–∞", cost: 50, income: 5},
    {name: "–õ–∞—Ä—ë–∫", cost: 120, income: 15},
    {name: "–ú–∞–≥–∞–∑–∏–Ω", cost: 300, income: 35},
    {name: "–§–∞–±—Ä–∏–∫–∞", cost: 700, income: 80}
];

let tiles = [];

/* ----------------- –°–û–•–†–ê–ù–ï–ù–ò–Ø ------------------ */

function save() {
    localStorage.setItem("tycoon3d", JSON.stringify({
        money, income, tiles
    }));
}

function load() {
    let data = localStorage.getItem("tycoon3d");
    if (data) {
        data = JSON.parse(data);
        money = data.money;
        income = data.income;
        tiles = data.tiles;
    }
}


/* ----------------- –ú–ò–† ------------------ */

const world = document.getElementById("world");

function createWorld() {

    if (tiles.length === 0) {
        // —Å–æ–∑–¥–∞—ë–º –ø—É—Å—Ç—ã–µ –∫–ª–µ—Ç–∫–∏ –≤–ø–µ—Ä–≤—ã–µ
        for (let y = 0; y < SIZE; y++) {
            for (let x = 0; x < SIZE; x++) {
                tiles.push({level: -1});
            }
        }
    }

    world.innerHTML = "";

    tiles.forEach((tile, i) => {
        const el = document.createElement("div");
        el.className = "tile";

        if (tile.level >= 0) el.classList.add("built");

        el.style.left = (i % SIZE) * TILE_SIZE + "px";
        el.style.top = Math.floor(i / SIZE) * TILE_SIZE + "px";

        el.onclick = () => tryBuild(i);

        world.appendChild(el);
        tile.el = el;
    });
}


/* ----------------- –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–û ------------------ */

function tryBuild(i) {
    const tile = tiles[i];
    const nextLevel = tile.level + 1;

    if (nextLevel >= buildings.length) return;

    const b = buildings[nextLevel];
    if (money < b.cost) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!");

    tile.level++;
    money -= b.cost;
    income += b.income;
    tile.el.classList.add("built");

    updateHUD();
    save();
}


/* ----------------- –ò–ì–†–û–ö ------------------ */

const player = document.createElement("div");
player.id = "player";
world.appendChild(player);

let px = 200;
let py = 200;

function movePlayer() {
    player.style.left = px + "px";
    player.style.top = py + "px";
}

movePlayer();

let keys = {};

document.onkeydown = e => keys[e.key] = true;
document.onkeyup = e => keys[e.key] = false;

function playerLoop() {
    if (keys["w"]) py -= 5;
    if (keys["s"]) py += 5;
    if (keys["a"]) px -= 5;
    if (keys["d"]) px += 5;

    px = Math.max(0, Math.min(px, (SIZE * TILE_SIZE) - 40));
    py = Math.max(0, Math.min(py, (SIZE * TILE_SIZE) - 40));

    movePlayer();
    requestAnimationFrame(playerLoop);
}
playerLoop();


/* ----------------- –î–û–•–û–î ------------------ */

function updateHUD() {
    document.getElementById("money").innerText = money;
}

setInterval(() => {
    money += income;
    updateHUD();
    save();
}, 3000);


/* ----------------- –ú–ê–ì–ê–ó–ò–ù ------------------ */

const shop = document.getElementById("shop");

document.getElementById("shop-btn").onclick = () => {
    shop.style.display = shop.style.display === "block" ? "none" : "block";
};

function renderShop() {
    shop.innerHTML = "";
    buildings.forEach(b => {
        const item = document.createElement("div");
        item.className = "shop-item";
        item.innerHTML = `<b>${b.name}</b><br>–¶–µ–Ω–∞: ${b.cost}<br>–î–æ—Ö–æ–¥: +${b.income}`;
        shop.appendChild(item);
    });
}


/* ----------------- –ó–ê–ü–£–°–ö ------------------ */

load();
createWorld();
updateHUD();
renderShop();

</script>

</body>
</html>