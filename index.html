<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Candy Match - –ê–Ω–∏–º–∞—Ü–∏–∏</title>
<style>
body {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: #2b2b2b;
    font-family: sans-serif;
    color: #fff;
    margin: 0;
    padding: 20px;
}

#info {
    display: flex;
    justify-content: space-between;
    width: 420px;
    margin-bottom: 10px;
}

#game {
    width: 420px;
    height: 420px;
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    grid-template-rows: repeat(8, 1fr);
    gap: 5px;
    background: #111;
    padding: 5px;
    position: relative;
}

.cell {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    cursor: pointer;
    transition: transform 0.3s;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2rem;
    user-select: none;
}

.cell.swap {
    z-index: 2;
    transition: transform 0.3s ease-in-out;
}

.cell.match {
    animation: explode 0.3s forwards;
}

@keyframes explode {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.5); opacity: 0.7; }
    100% { transform: scale(0); opacity: 0; }
}

#message {
    margin-top: 20px;
    font-size: 1.2em;
}
</style>
</head>
<body>

<div id="info">
    <div>–°—á—ë—Ç: <span id="score">0</span></div>
    <div>–•–æ–¥—ã: <span id="moves">30</span></div>
    <div>–í—Ä–µ–º—è: <span id="timer">60</span> —Å</div>
</div>

<div id="game"></div>
<div id="message"></div>

<script>
const size = 8;
const candies = [
    'üç¨', 'üç≠', 'üç´', 'üç°', 'üç™'
];
let grid = [];
let firstCell = null;
let score = 0;
let moves = 30;
let timer = 60;
let timerInterval;
let animating = false;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function init() {
    const game = document.getElementById("game");
    game.innerHTML = '';
    for (let i = 0; i < size * size; i++) {
        const div = document.createElement("div");
        div.className = "cell";
        div.dataset.index = i;
        game.appendChild(div);
    }
    fillGrid();
    render();
    updateInfo();
    startTimer();
}

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ—Ç–∫–∏
function fillGrid() {
    grid = Array(size * size).fill().map(() => candies[Math.floor(Math.random() * candies.length)]);
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞
function render() {
    document.querySelectorAll(".cell").forEach((cell, i) => {
        cell.textContent = grid[i];
        cell.classList.remove('match', 'swap');
        cell.onclick = () => clickCell(i);
        cell.ontouchstart = () => clickCell(i);
    });
}

// –ö–ª–∏–∫ –ø–æ –∫–ª–µ—Ç–∫–µ
function clickCell(i) {
    if (moves <= 0 || animating) return;
    if (firstCell === null) {
        firstCell = i;
        return;
    }
    if (isNeighbor(firstCell, i)) {
        animating = true;
        animateSwap(firstCell, i).then(() => {
            if (findMatches().length > 0) {
                moves--;
                processMatches();
            } else {
                // –æ—Ç–º–µ–Ω—è–µ–º, –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                animateSwap(firstCell, i).then(() => { animating = false; });
            }
            updateInfo();
            checkGameOver();
        });
    }
    firstCell = null;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å–µ–¥—Å—Ç–≤–∞
function isNeighbor(a, b) {
    const ax = a % size, ay = Math.floor(a / size);
    const bx = b % size, by = Math.floor(b / size);
    return (Math.abs(ax - bx) + Math.abs(ay - by)) === 1;
}

// –ê–Ω–∏–º–∞—Ü–∏—è —Å–º–µ–Ω—ã –º–µ—Å—Ç
function animateSwap(a, b) {
    return new Promise(resolve => {
        const cells = document.querySelectorAll('.cell');
        const cellA = cells[a];
        const cellB = cells[b];

        const dx = (cellB.offsetLeft - cellA.offsetLeft);
        const dy = (cellB.offsetTop - cellA.offsetTop);

        cellA.classList.add('swap');
        cellB.classList.add('swap');

        cellA.style.transform = `translate(${dx}px, ${dy}px)`;
        cellB.style.transform = `translate(${-dx}px, ${-dy}px)`;

        setTimeout(() => {
            cellA.style.transform = '';
            cellB.style.transform = '';
            swapCells(a, b);
            render();
            resolve();
        }, 300);
    });
}

// –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏
function swapCells(a, b) {
    [grid[a], grid[b]] = [grid[b], grid[a]];
}

// –ü–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
function findMatches() {
    let matches = [];

    // –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
    for (let y = 0; y < size; y++) {
        for (let x = 0; x < size - 2; x++) {
            const i = y * size + x;
            if (grid[i] === grid[i + 1] && grid[i] === grid[i + 2]) {
                matches.push(i, i + 1, i + 2);
            }
        }
    }

    // –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
    for (let x = 0; x < size; x++) {
        for (let y = 0; y < size - 2; y++) {
            const i = y * size + x;
            if (grid[i] === grid[i + size] && grid[i] === grid[i + size * 2]) {
                matches.push(i, i + size, i + size * 2);
            }
        }
    }

    return [...new Set(matches)];
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
function processMatches() {
    let matches = findMatches();
    if (matches.length === 0) {
        animating = false;
        return;
    }

    matches.forEach(i => {
        grid[i] = null;
        document.querySelectorAll('.cell')[i].classList.add('match');
    });

    score += matches.length * 10;

    setTimeout(() => {
        // —Å–º–µ—â–∞–µ–º –≤–Ω–∏–∑
        for (let x = 0; x < size; x++) {
            let col = [];
            for (let y = 0; y < size; y++) {
                const i = y * size + x;
                if (grid[i] !== null) col.push(grid[i]);
            }
            while (col.length < size) col.unshift(candies[Math.floor(Math.random() * candies.length)]);
            for (let y = 0; y < size; y++) grid[y * size + x] = col[y];
        }
        render();
        setTimeout(processMatches, 300);
    }, 300);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
function updateInfo() {
    document.getElementById("score").textContent = score;
    document.getElementById("moves").textContent = moves;
}

// –¢–∞–π–º–µ—Ä
function startTimer() {
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        timer--;
        document.getElementById("timer").textContent = timer;
        if (timer <= 0) {
            clearInterval(timerInterval);
            endGame();
        }
    }, 1000);
}

// –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
function endGame() {
    document.getElementById("message").textContent = "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à —Å—á—ë—Ç: " + score;
    moves = 0;
    animating = true;
}

init();
</script>
</body>
</html>