<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Candy Match</title>
<style>
    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: #222;
        font-family: sans-serif;
        color: #fff;
        margin: 0;
        padding: 20px;
    }
    #info {
        display: flex;
        justify-content: space-between;
        width: 400px;
        margin-bottom: 10px;
    }
    #game {
        width: 400px;
        height: 400px;
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        grid-template-rows: repeat(8, 1fr);
        gap: 2px;
        background: #111;
        padding: 5px;
        position: relative;
    }
    .cell {
        width: 100%;
        height: 100%;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.2s;
        background-size: cover;
        background-position: center;
    }
    .cell:hover {
        transform: scale(1.1);
    }
    #message {
        margin-top: 20px;
        font-size: 1.2em;
    }
</style>
</head>
<body>

<div id="info">
    <div>–°—á—ë—Ç: <span id="score">0</span></div>
    <div>–•–æ–¥—ã: <span id="moves">30</span></div>
    <div>–í—Ä–µ–º—è: <span id="timer">60</span> —Å</div>
</div>

<div id="game"></div>
<div id="message"></div>

<script>
const size = 8;
const candies = [
    'üç¨', 'üç≠', 'üç´', 'üç°', 'üç™' // —ç–º–æ–¥–∑–∏ –≤–º–µ—Å—Ç–æ —Å–ø—Ä–∞–π—Ç–æ–≤ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
];
let grid = [];
let firstCell = null;
let score = 0;
let moves = 30;
let timer = 60;
let timerInterval;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function init() {
    const game = document.getElementById("game");
    game.innerHTML = '';
    for (let i = 0; i < size * size; i++) {
        const div = document.createElement("div");
        div.className = "cell";
        div.dataset.index = i;
        game.appendChild(div);
    }
    fillGrid();
    render();
    updateInfo();
    startTimer();
}

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ—Ç–∫–∏
function fillGrid() {
    grid = Array(size * size).fill().map(() => candies[Math.floor(Math.random() * candies.length)]);
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞
function render() {
    document.querySelectorAll(".cell").forEach((cell, i) => {
        cell.textContent = grid[i];
        cell.onclick = () => clickCell(i);
        cell.ontouchstart = () => clickCell(i); // –º–æ–±–∏–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
    });
}

// –ö–ª–∏–∫ –ø–æ –∫–ª–µ—Ç–∫–µ
function clickCell(i) {
    if (moves <= 0) return;
    if (firstCell === null) {
        firstCell = i;
        return;
    }
    if (isNeighbor(firstCell, i)) {
        swapCells(firstCell, i);
        if (findMatches().length > 0) {
            moves--;
            processMatches();
        } else {
            swapCells(firstCell, i); // –æ—Ç–º–µ–Ω–∞ –µ—Å–ª–∏ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
        }
        render();
        updateInfo();
        checkGameOver();
    }
    firstCell = null;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å–µ–¥—Å—Ç–≤–∞
function isNeighbor(a, b) {
    const ax = a % size, ay = Math.floor(a / size);
    const bx = b % size, by = Math.floor(b / size);
    return (Math.abs(ax - bx) + Math.abs(ay - by)) === 1;
}

// –ú–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏
function swapCells(a, b) {
    [grid[a], grid[b]] = [grid[b], grid[a]];
}

// –ü–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
function findMatches() {
    let matches = [];

    // –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
    for (let y = 0; y < size; y++) {
        for (let x = 0; x < size - 2; x++) {
            const i = y * size + x;
            if (grid[i] === grid[i + 1] && grid[i] === grid[i + 2]) {
                matches.push(i, i + 1, i + 2);
            }
        }
    }

    // –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
    for (let x = 0; x < size; x++) {
        for (let y = 0; y < size - 2; y++) {
            const i = y * size + x;
            if (grid[i] === grid[i + size] && grid[i] === grid[i + size * 2]) {
                matches.push(i, i + size, i + size * 2);
            }
        }
    }

    return [...new Set(matches)];
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
function processMatches() {
    let matches = findMatches();
    while (matches.length > 0) {
        score += matches.length * 10;
        matches.forEach(i => grid[i] = null);

        // —Å–º–µ—â–∞–µ–º –≤–Ω–∏–∑
        for (let x = 0; x < size; x++) {
            let col = [];
            for (let y = 0; y < size; y++) {
                const i = y * size + x;
                if (grid[i] !== null) col.push(grid[i]);
            }
            while (col.length < size) col.unshift(candies[Math.floor(Math.random() * candies.length)]);
            for (let y = 0; y < size; y++) grid[y * size + x] = col[y];
        }

        matches = findMatches();
    }
    render();
    updateInfo();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
function updateInfo() {
    document.getElementById("score").textContent = score;
    document.getElementById("moves").textContent = moves;
}

// –¢–∞–π–º–µ—Ä
function startTimer() {
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        timer--;
        document.getElementById("timer").textContent = timer;
        if (timer <= 0) {
            clearInterval(timerInterval);
            endGame();
        }
    }, 1000);
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã
function checkGameOver() {
    if (moves <= 0) endGame();
}

// –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã
function endGame() {
    document.getElementById("message").textContent = "–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à —Å—á—ë—Ç: " + score;
    moves = 0;
}

init();
</script>
</body>
</html>