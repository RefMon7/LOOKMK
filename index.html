<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mini Tycoon 3D Mobile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
    body {
        margin: 0;
        font-family: 'Segoe UI', sans-serif;
        background: #1c1c2b;
        color: #fff;
        overflow: hidden;
        touch-action: none; /* –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–∫—Ä–æ–ª–ª –ø—Ä–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ */
    }

    /* HUD */
    #hud {
        position: fixed;
        top: 10px;
        left: 10px;
        font-size: 20px;
        background: rgba(0,0,0,0.45);
        padding: 10px 15px;
        border-radius: 10px;
        z-index: 20;
    }

    #shop-btn {
        position: fixed;
        right: 10px;
        top: 10px;
        background: #4a7efc;
        padding: 10px 15px;
        border-radius: 10px;
        font-size: 18px;
        cursor: pointer;
        z-index: 20;
    }

    #shop {
        position: fixed;
        right: 10px;
        top: 60px;
        width: 240px;
        background: rgba(0,0,0,0.6);
        padding: 12px;
        border-radius: 10px;
        display: none;
        z-index: 20;
    }
    .shop-item {
        padding: 10px;
        background: rgba(255,255,255,0.1);
        margin: 6px 0;
        border-radius: 10px;
    }

    /* –°—Ü–µ–Ω–∞ */
    #scene {
        width: 100vw;
        height: 100vh;
        perspective: 1200px;
    }

    #world {
        width: 1600px;
        height: 1600px;
        position: relative;
        transform-style: preserve-3d;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotateX(55deg) rotateZ(45deg) scale(0.7);
    }

    /* –ö–ª–µ—Ç–∫–∏ */
    .tile {
        position: absolute;
        width: 200px;
        height: 200px;
        background: #2d2d3f;
        border: 2px solid #444;
        border-radius: 6px;
    }
    .tile.built {
        background: #4caf50;
        box-shadow: 0 0 12px rgba(76,175,80,0.8);
    }

    /* –ò–≥—Ä–æ–∫ */
    #player {
        width: 40px;
        height: 40px;
        position: absolute;
        background: #ffeb3b;
        border-radius: 50%;
        box-shadow: 0 0 18px rgba(255,235,59,0.8);
    }

    /* –ú–æ–±–∏–ª—å–Ω—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ */
    #joystickArea {
        position: fixed;
        bottom: 20px;
        left: 20px;
        width: 160px;
        height: 160px;
        border-radius: 50%;
        background: rgba(255,255,255,0.1);
        z-index: 30;
        touch-action: none;
    }

    #stick {
        width: 70px;
        height: 70px;
        background: rgba(255,255,255,0.4);
        border-radius: 50%;
        position: absolute;
        left: 45px;
        top: 45px;
    }
</style>
</head>
<body>

<div id="hud">üí∞ <span id="money">0</span></div>
<div id="shop-btn">üõí</div>
<div id="shop"></div>

<div id="scene">
    <div id="world"></div>
</div>

<!-- –î–∂–æ–π—Å—Ç–∏–∫ -->
<div id="joystickArea">
    <div id="stick"></div>
</div>

<script>
/* ------------------- –î–ê–ù–ù–´–ï ------------------- */

let money = 0;
let income = 0;

const SIZE = 5;
const TILE_SIZE = 200;
let tiles = [];

const buildings = [
    {name: "–ü–∞–ª–∞—Ç–∫–∞", cost: 40, income: 5},
    {name: "–õ–∞—Ä—ë–∫", cost: 120, income: 15},
    {name: "–ú–∞–≥–∞–∑–∏–Ω", cost: 330, income: 40},
    {name: "–§–∞–±—Ä–∏–∫–∞", cost: 750, income: 85}
];

/* ------------------- –°–û–•–†–ê–ù–ï–ù–ò–ï ------------------- */

function save() {
    localStorage.setItem("tycoon_mobile", JSON.stringify({
        money, income, tiles
    }));
}

function load() {
    let data = localStorage.getItem("tycoon_mobile");
    if (data) {
        data = JSON.parse(data);
        money = data.money;
        income = data.income;
        tiles = data.tiles;
    }
}

/* ------------------- –ú–ò–† ------------------- */

const world = document.getElementById("world");

function createWorld() {
    if (tiles.length === 0) {
        for (let i = 0; i < SIZE * SIZE; i++) tiles.push({level: -1});
    }

    world.innerHTML = "";

    tiles.forEach((tile, i) => {
        const el = document.createElement("div");
        el.className = "tile";
        if (tile.level >= 0) el.classList.add("built");

        el.style.left = (i % SIZE) * TILE_SIZE + "px";
        el.style.top = Math.floor(i / SIZE) * TILE_SIZE + "px";

        el.onclick = () => build(i);

        tile.el = el;
        world.appendChild(el);
    });
}

/* ------------------- –°–¢–†–û–ò–¢–ï–õ–¨–°–¢–í–û ------------------- */

function build(i) {
    let t = tiles[i];
    let next = t.level + 1;

    if (next > buildings.length - 1) return;

    let b = buildings[next];
    if (money < b.cost) return alert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥!");

    t.level++;
    money -= b.cost;
    income += b.income;
    t.el.classList.add("built");

    updateHUD();
    save();
}

/* ------------------- –ò–ì–†–û–ö ------------------- */

const player = document.createElement("div");
player.id = "player";
world.appendChild(player);

let px = 200, py = 200;

function movePlayer() {
    player.style.left = px + "px";
    player.style.top = py + "px";
}

movePlayer();

/* ------------------- –ú–û–ë–ò–õ–¨–ù–´–ô –î–ñ–û–ô–°–¢–ò–ö ------------------- */

const joy = document.getElementById("joystickArea");
const stick = document.getElementById("stick");

let joyX = 0, joyY = 0;

joy.addEventListener("touchmove", (e) => {
    let rect = joy.getBoundingClientRect();
    let x = e.touches[0].clientX - rect.left - rect.width / 2;
    let y = e.touches[0].clientY - rect.top - rect.height / 2;

    const max = 50;
    let dist = Math.sqrt(x*x + y*y);

    if (dist > max) {
        x = x / dist * max;
        y = y / dist * max;
    }

    stick.style.transform = `translate(${x}px, ${y}px)`;

    joyX = x / max;
    joyY = y / max;
});

joy.addEventListener("touchend", () => {
    stick.style.transform = `translate(0px,0px)`;
    joyX = joyY = 0;
});

/* ------------------- –î–í–ò–ñ–ï–ù–ò–ï ------------------- */

function loop() {
    px += joyX * 6;
    py += joyY * 6;

    px = Math.max(0, Math.min(px, SIZE * TILE_SIZE - 40));
    py = Math.max(0, Math.min(py, SIZE * TILE_SIZE - 40));

    movePlayer();
    requestAnimationFrame(loop);
}
loop();

/* ------------------- –î–û–•–û–î ------------------- */

function updateHUD() {
    document.getElementById("money").innerText = money;
}

setInterval(() => {
    money += income;
    updateHUD();
    save();
}, 3000);

/* ------------------- –ú–ê–ì–ê–ó–ò–ù ------------------- */

const shop = document.getElementById("shop");
document.getElementById("shop-btn").onclick = () => {
    shop.style.display = shop.style.display === "block" ? "none" : "block";
};

function renderShop() {
    shop.innerHTML = "";
    buildings.forEach(b => {
        let d = document.createElement("div");
        d.className = "shop-item";
        d.innerHTML = `<b>${b.name}</b><br>–¶–µ–Ω–∞: ${b.cost}<br>–î–æ—Ö–æ–¥: +${b.income}`;
        shop.appendChild(d);
    });
}

/* ------------------- –ó–ê–ü–£–°–ö ------------------- */
load();
createWorld();
renderShop();
updateHUD();

</script>
</body>
</html>